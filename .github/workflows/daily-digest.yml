name: ğŸ“° AI Daily Digest

on:
  # æ¯æœ JST 7:00 (UTC 22:00) ã«å®Ÿè¡Œ
  schedule:
    - cron: '0 22 * * *'
  # æ‰‹å‹•å®Ÿè¡Œã‚‚å¯èƒ½
  workflow_dispatch:

permissions:
  contents: write
  issues: write
  pull-requests: write

jobs:
  create-digest-issue:
    runs-on: ubuntu-latest
    steps:
      - name: æ—¥ä»˜ã‚’å–å¾—
        id: date
        run: |
          # JST (UTC+9) ã®æ—¥ä»˜ã‚’å–å¾—
          echo "today=$(TZ=Asia/Tokyo date +'%Y-%m-%d')" >> $GITHUB_OUTPUT

      - name: Daily Digest Issue ã‚’ä½œæˆã— Copilot ã‚’ã‚¢ã‚µã‚¤ãƒ³
        env:
          GH_TOKEN: ${{ secrets.GH_TOKEN != '' && secrets.GH_TOKEN || github.token }}
        run: |
          TODAY="${{ steps.date.outputs.today }}"
          
          ISSUE_TITLE="ğŸ“° AI Daily Digest - ${TODAY}"
          
          ISSUE_BODY="# ğŸ¤– AI News Daily Digest

          ## åé›†å¯¾è±¡æ—¥
          ${TODAY}

          ## åé›†å¯¾è±¡ã‚µã‚¤ãƒˆ
          1. **MIT Technology Review** - https://www.technologyreview.com/topic/artificial-intelligence/
          2. **VentureBeat AI** - https://venturebeat.com/category/ai/
          3. **TechCrunch AI** - https://techcrunch.com/tag/artificial-intelligence/
          4. **The Verge AI** - https://www.theverge.com/ai-artificial-intelligence
          5. **Towards Data Science** - https://towardsdatascience.com/

          ## å‡ºåŠ›å½¢å¼
          - å„ã‚µã‚¤ãƒˆã‹ã‚‰1-2ä»¶ã®é‡è¦è¨˜äº‹ã‚’é¸å®š
          - æ—¥æœ¬èªã§è¦ç´„ã‚’ä½œæˆ
          - 10åˆ†ã§èª­ã‚ã‚‹åˆ†é‡ï¼ˆç´„2000-3000æ–‡å­—ï¼‰
          - å®Ÿè·µçš„ãªã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚¢ã‚¤ãƒ†ãƒ ã‚’å«ã‚ã‚‹

          ## å‡ºåŠ›å…ˆ
          \`daily/${TODAY}.md\`

          ---

          @copilot ä¸Šè¨˜ã®åé›†å¯¾è±¡ã‚µã‚¤ãƒˆã‹ã‚‰æœ€æ–°ã®AIé–¢é€£ãƒ‹ãƒ¥ãƒ¼ã‚¹ã‚’åé›†ã—ã€è¦ç´„ã‚’ä½œæˆã—ã¦ãã ã•ã„ã€‚"
          
          # Issue ã‚’ä½œæˆ
          ISSUE_URL=$(gh issue create \
            --repo "${{ github.repository }}" \
            --title "$ISSUE_TITLE" \
            --body "$ISSUE_BODY" \
            --label "copilot")
          
          echo "âœ… Issue created: $ISSUE_URL"
          
          # Issueç•ªå·ã‚’æŠ½å‡º
          ISSUE_NUMBER=$(echo "$ISSUE_URL" | grep -o '[0-9]*$')
          echo "Issue number: $ISSUE_NUMBER"
          
          # GitHub APIã§Copilotã‚’ã‚¢ã‚µã‚¤ãƒ³
          gh api \
            --method POST \
            -H "Accept: application/vnd.github+json" \
            -H "X-GitHub-Api-Version: 2022-11-28" \
            "/repos/${{ github.repository }}/issues/$ISSUE_NUMBER/assignees" \
            --input - <<EOF || echo "âš ï¸ Copilotã®è‡ªå‹•ã‚¢ã‚µã‚¤ãƒ³ã«å¤±æ•—ï¼ˆIssueæœ¬æ–‡ã®@copilotãƒ¡ãƒ³ã‚·ãƒ§ãƒ³ã§èµ·å‹•ã—ã¾ã™ï¼‰"
          {
            "assignees": ["copilot-swe-agent[bot]"],
            "agent_assignment": {
              "target_repo": "${{ github.repository }}",
              "base_branch": "${{ github.event.repository.default_branch || 'main' }}",
              "custom_instructions": "",
              "custom_agent": "",
              "model": ""
            }
          }
          EOF
          
          echo "âœ… Copilot assigned to issue #$ISSUE_NUMBER"
